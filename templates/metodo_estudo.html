<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumi – Método de Estudo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Container principal do conteúdo (caixa branca) */
        .quiz-container { 
            width: 100%; 
            max-width: 800px; 
            background: white; 
            border-radius: 15px; 
            padding: 30px 40px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
            margin-bottom: 40px; 
            overflow: visible; /* MUDADO: Permite que o botão absoluto "vaze" */
            position: relative; /* FUNDAMENTAL para posicionar o botão Voltar */
            margin-top: 50px; /* Adiciona espaço acima para o botão Voltar */
        }
        .quiz-container h1 { text-align: center; color: #4B8BEA; margin-top: 0; margin-bottom: 10px; }
        .quiz-container > p { text-align: center; color: #555; margin-top: 0; margin-bottom: 30px; }
        
        /* === BOTÃO DE VOLTAR POSICIONADO FORA/ACIMA DA CAIXA === */
        .back-to-main-global-btn {
            position: absolute; 
            top: -30px;  /* Puxa para CIMA (fora da caixa). Ajuste o valor (-25px, -35px?) */
            left: 0px;   /* Alinha com a borda ESQUERDA da ÁREA DE PADDING da caixa. */
                         /* Se quiser alinhar com a BORDA EXTERNA, use 'left: -40px;' (igual ao padding horizontal) */
            background: none; border: none; color: #4B8BEA; font-size: 0.9em;
            font-weight: 500; cursor: pointer; text-decoration: none; 
            display: flex; align-items: center; gap: 5px; transition: color 0.2s;
            z-index: 10; 
        }
        .back-to-main-global-btn:hover { color: #1e3a8a; }
        .back-to-main-global-btn svg { width: 18px; height: 18px; fill: currentColor; }
        /* === FIM BOTÃO DE VOLTAR === */

        /* Barra de Progresso */
        .quiz-progress-container { width: 100%; background-color: #f0f5ff; border-radius: 10px; margin-bottom: 25px; }
        .quiz-progress-bar { width: 0%; height: 10px; background-color: #4B8BEA; border-radius: 10px; transition: width 0.3s ease-in-out; }

        /* Animação e display das páginas */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #quiz-area, #resultado-area { animation: fadeIn 0.5s; } 
        .hidden { display: none !important; } 

        /* Estilo das perguntas e opções */
        .quiz-pergunta h3 { margin-top: 0; color: #333; font-size: 1.3em; line-height: 1.5; }
        .quiz-opcoes { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .quiz-opcao { display: block; padding: 15px; border: 1px solid #E0E8FF; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; background-color: #f9fafc; color: #333; font-size: 1.05em; }
        .quiz-opcao:hover { background-color: #f0f5ff; }
        .quiz-opcao.selected { background-color: #E6EEFF; border-color: #4B8BEA; font-weight: 600; color: #1e3a8a; }
        .quiz-opcao input { display: none; } 

        /* Navegação (botões Anterior/Próximo/Finalizar) */
        .quiz-nav { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
        
        /* Estilo unificado para botões de ação */
        .quiz-nav-btn, .quiz-restart-btn {
            padding: 10px 20px; min-width: 120px; text-align: center; 
            font-size: 1em; font-weight: 500; border-radius: 8px; cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            border: 1px solid transparent; box-sizing: border-box; 
        }
        /* Botões Azuis (Próximo, Ver Resultado) */
        .quiz-nav-btn.next, .quiz-nav-btn.finish { background: #4B8BEA; color: white; border-color: #4B8BEA; }
        .quiz-nav-btn.next:hover, .quiz-nav-btn.finish:hover { background: #3a74d3; border-color: #3a74d3; }
        .quiz-nav-btn.next:disabled, .quiz-nav-btn.finish:disabled { background-color: #c3d9ff; border-color: #c3d9ff; cursor: not-allowed; }
        /* Botão Anterior (Borda Azul) */
        .quiz-nav-btn.prev { background: none; border: 1px solid #c3d9ff; color: #4B8BEA; }
        .quiz-nav-btn.prev:hover { background: #f0f5ff; }
        /* Botão Refazer Teste (Borda Azul) */
        .quiz-restart-btn { background: none; border: 1px solid #4B8BEA; color: #4B8BEA; margin-top: 25px; }
        .quiz-restart-btn:hover { background-color: #E6EEFF; }
        
        /* Estilo do Resultado */
        .quiz-resultado { text-align: center; }
        .quiz-resultado h2 { color: #4B8BEA; margin-top: 0; margin-bottom: 20px; }
        .quiz-resultado p { font-size: 1.1em; line-height: 1.6; margin: 20px 0; }
        #resultado-grafico-container { width: 100%; max-width: 350px; margin: 20px auto; }
        
        /* Mensagem de Erro */
        .quiz-error { text-align: center; color: #d9534f; background-color: #f2dede; border: 1px solid #ebccd1; padding: 15px; border-radius: 10px; }
    </style>
</head>

<body>
    <header>
        <a href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='lumi_logo.jpg') }}" alt="Logo Lumi" class="logo">
        </a>
    </header>

    <main class="faq-page"> 

        <div class="quiz-container">

            <a href="{{ url_for('index') }}" class="back-to-main-global-btn" id="back-to-main-global-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
                </svg>
                Voltar à Principal
            </a>
            
            <div id="quiz-area">
                <h1 id="quiz-titulo"></h1>
                <p id="quiz-descricao"></p>
                <div class="quiz-progress-container"> <div class="quiz-progress-bar" id="quiz-progress-bar"></div> </div>
                <div id="quiz-content">
                    <div class="quiz-pergunta"> <h3 id="pergunta-texto"></h3> </div>
                    <div class="quiz-opcoes" id="quiz-opcoes"> </div>
                </div>
                <div class="quiz-nav">
                    <button class="quiz-nav-btn prev hidden" id="prev-btn">Anterior</button> 
                    <button class="quiz-nav-btn next" id="next-btn" disabled>Próximo</button>
                    <button class="quiz-nav-btn finish hidden" id="finish-btn" disabled>Ver Resultado</button> 
                </div>
            </div>

            <div id="resultado-area" class="quiz-resultado hidden">
                <h2 id="resultado-titulo"></h2>
                <div id="resultado-grafico-container"> <canvas id="resultado-grafico"></canvas> </div>
                <p id="resultado-descricao"></p>
                <button id="quiz-restart-btn" class="quiz-restart-btn">Refazer Teste</button>
            </div>

            <div id="quiz-error-area" class="quiz-error hidden">
                <h2>Ops! Algo deu errado.</h2>
                <p>Não consegui carregar as perguntas. Tente recarregar a página.</p>
            </div>

        </div> </main>

    <script>
        // O JavaScript continua EXATAMENTE o mesmo da resposta anterior.
        // Certifique-se de que a variável `fullQuizData` contenha as perguntas.
        document.addEventListener('DOMContentLoaded', function() {
            const fullQuizData = { /* Colar aqui os dados completos do quiz */ };
            // Cole aqui os dados completos do quiz da resposta anterior, se precisar.
             const fullQuizDataPlaceholder = { // Substitua isso pelos dados reais
              "titulo": "Descubra seu Método de Estudo (VARK)",
              "descricao": "Responda às 15 perguntas para descobrir seu perfil de aprendizagem ideal.",
              "perguntas": [ 
                { "pergunta": "Você precisa aprender a usar um novo software. Qual a sua primeira ação?", "opcoes": [ { "texto": "Assisto a um tutorial em vídeo mostrando como usá-lo.", "valor": "V" }, { "texto": "Peço a um colega para me explicar oralmente o básico.", "valor": "A" }, { "texto": "Leio o manual de instruções ou a documentação online.", "valor": "R" }, { "texto": "Começo a clicar nos botões e menus para descobrir por conta própria.", "valor": "K" } ] },
                { "pergunta": "Ao montar um móvel, você prefere:", "opcoes": [ { "texto": "Seguir atentamente os diagramas e ilustrações.", "valor": "V" }, { "texto": "Que alguém leia as instruções para você em voz alta.", "valor": "A" }, { "texto": "Ler todas as instruções escritas, passo a passo, primeiro.", "valor": "R" }, { "texto": "Pegar as peças e ir montando, 'sentindo' como se encaixam.", "valor": "K" } ] },
                { "pergunta": "Como você prefere que um professor te dê feedback sobre um trabalho?", "opcoes": [ { "texto": "Com anotações visuais, setas ou destaques no seu trabalho.", "valor": "V" }, { "texto": "Em uma conversa particular para que ele possa me explicar.", "valor": "A" }, { "texto": "Por escrito, em um e-mail ou documento detalhado.", "valor": "R" }, { "texto": "Mostrando exemplos práticos de como eu poderia melhorar.", "valor": "K" } ] },
                { "pergunta": "Você está tentando se localizar em uma cidade nova. O que você faz?", "opcoes": [ { "texto": "Olho para um mapa no celular ou um mapa físico.", "valor": "V" }, { "texto": "Pergunto a alguém na rua por direções.", "valor": "A" }, { "texto": "Leio as placas com os nomes das ruas e as direções.", "valor": "R" }, { "texto": "Começo a andar para 'sentir' a direção e reconhecer o caminho.", "valor": "K" } ] },
                { "pergunta": "Qual tipo de site ou rede social mais te atrai?", "opcoes": [ { "texto": "Pinterest ou Instagram (foco em imagens e vídeos).", "valor": "V" }, { "texto": "Podcasts ou Twitter Spaces (foco em áudio e conversas).", "valor": "A" }, { "texto": "Blogs, Wikipedia ou Twitter (foco em texto).", "valor": "R" }, { "texto": "TikTok ou sites interativos (foco em ação e criação).", "valor": "K" } ] },
                { "pergunta": "O que você faz quando precisa se lembrar de uma informação importante?", "opcoes": [ { "texto": "Crio um mapa mental ou um esquema colorido.", "valor": "V" }, { "texto": "Repito a informação em voz alta para mim mesmo.", "valor": "A" }, { "texto": "Escrevo a informação várias vezes em um caderno.", "valor": "R" }, { "texto": "Associo a informação a um gesto ou movimento físico.", "valor": "K" } ] },
                { "pergunta": "Em uma aula, o que mais te ajuda a se concentrar?", "opcoes": [ { "texto": "Apresentações de slides, gráficos e vídeos.", "valor": "V" }, { "texto": "O tom de voz do professor e as discussões em grupo.", "valor": "A" }, { "texto": "Apostilas ou anotações detalhadas no quadro.", "valor": "R" }, { "texto": "Atividades práticas, experimentos ou poder se movimentar.", "valor": "K" } ] },
                { "pergunta": "Como você ensinaria um amigo a fazer algo novo (ex: uma receita)?", "opcoes": [ { "texto": "Eu mostraria um vídeo ou fotos do processo.", "valor": "V" }, { "texto": "Eu explicaria verbalmente, passo a passo.", "valor": "A" }, { "texto": "Eu escreveria a receita e as instruções para ele.", "valor": "R" }, { "texto": "Eu faria junto com ele, mostrando na prática.", "valor": "K" } ] },
                { "pergunta": "Ao escolher um livro de não-ficção, o que mais te atrai?", "opcoes": [ { "texto": "A capa, as ilustrações e a diagramação.", "valor": "V" }, { "texto": "A possibilidade de ouvir a versão em audiobook.", "valor": "A" }, { "texto": "A sinopse escrita e as resenhas detalhadas.", "valor": "R" }, { "texto": "Se for um livro-caixa com atividades ou um guia prático.", "valor": "K" } ] },
                { "pergunta": "Qual é o seu método preferido para revisar para uma prova?", "opcoes": [ { "texto": "Rever meus resumos visuais, fluxogramas e gráficos.", "valor": "V" }, { "texto": "Gravar áudios de mim mesmo lendo a matéria e ouvi-los.", "valor": "A" }, { "texto": "Reler e reescrever minhas anotações e os capítulos do livro.", "valor": "R" }, { "texto": "Fazer simulados, flashcards (movimentando) ou explicar para a parede.", "valor": "K" } ] },
                { "pergunta": "Você está em um museu. O que você mais gosta de fazer?", "opcoes": [ { "texto": "Observar atentamente as pinturas, esculturas e o design.", "valor": "V" }, { "texto": "Usar o audioguia para ouvir as explicações de cada obra.", "valor": "A" }, { "texto": "Ler todas as placas de descrição e informações históricas.", "valor": "R" }, { "texto": "Participar das exibições interativas onde se pode tocar ou experimentar.", "valor": "K" } ] },
                { "pergunta": "Quando você ouve uma palavra que não conhece, o que você faz?", "opcoes": [ { "texto": "Imagino a palavra escrita para tentar entender.", "valor": "V" }, { "texto": "Peço para a pessoa repetir ou soletrar para mim.", "valor": "A" }, { "texto": "Procuro a palavra no dicionário ou no Google.", "valor": "R" }, { "texto": "Tento usar a palavra em uma frase para ver se faz sentido.", "valor": "K" } ] },
                { "pergunta": "O que mais te distrai em uma sala de aula ou trabalho?", "opcoes": [ { "texto": "Muita poluição visual, cores berrantes ou movimento.", "valor": "V" }, { "texto": "Conversas paralelas, ruídos ou música alta.", "valor": "A" }, { "texto": "Textos mal escritos ou e-mails com erros de digitação.", "valor": "R" }, { "texto": "Ficar sentado por muito tempo, sem poder me esticar.", "valor": "K" } ] },
                { "pergunta": "Como você memoriza melhor um caminho?", "opcoes": [ { "texto": "Lembrando de pontos de referência visuais (ex: 'o prédio azul').", "valor": "V" }, { "texto": "Lembrando das instruções verbais (ex: 'vire à direita depois do...').", "valor": "A" }, { "texto": "Lembrando dos nomes das ruas que eu li nas placas.", "valor": "R" }, { "texto": "Lembrando da 'sensação' de virar o corpo para a esquerda ou direita.", "valor": "K" } ] },
                { "pergunta": "No seu tempo livre, você prefere:", "opcoes": [ { "texto": "Fotografar, desenhar, ir ao cinema ou assistir séries.", "valor": "V" }, { "texto": "Ouvir música, ir a shows, ou conversar longamente com amigos.", "valor": "A" }, { "texto": "Ler livros, escrever em um diário ou jogar palavras-cruzadas.", "valor": "R" }, { "texto": "Praticar esportes, dançar, cozinhar ou fazer trabalhos manuais.", "valor": "K" } ] }
              ],
              "resultados": { 
                "V": { "titulo": "Seu estilo principal é: VISUAL (V)", "descricao": "Você aprende melhor vendo. Gráficos, diagramas, fluxogramas, vídeos e demonstrações são suas ferramentas ideais. Você tende a criar 'imagens mentais' para se lembrar das coisas. Para estudar, use e abuse de mapas mentais, anotações coloridas e assista a videoaulas." },
                "A": { "titulo": "Seu estilo principal é: AUDITIVO (A)", "descricao": "Você aprende melhor ouvindo. Palestras, discussões em grupo, podcasts e explicações verbais são perfeitos para você. Você tende a se lembrar do que foi dito. Para estudar, tente ler suas anotações em voz alta, grave áudios explicando a matéria e participe de grupos de debate." },
                "R": { "titulo": "Seu estilo principal é: LEITURA/ESCRITA (R)", "descricao": "Você aprende melhor através da palavra escrita. Ler e escrever são suas maiores forças. Manuais, livros, apostilas e anotações detalhadas são essenciais para você. Para estudar, crie resumos bem escritos, reescreva os conceitos com suas próprias palavras e leia muito sobre o assunto." },
                "K": { "titulo": "Seu estilo principal é: CINÉTICO/PRÁTICO (K)", "descricao": "Você aprende melhor fazendo, tocando e experimentando. Aulas em laboratório, simulações, projetos práticos e qualquer coisa 'mão na massa' são ideais. Você precisa de ação. Para estudar, use flashcards, monte modelos, faça experimentos e tente aplicar o conceito em um exemplo real." },
                "Multimodal": { "titulo": "Seu estilo principal é: MULTIMODAL (Misto)", "descricao": "Você não tem um único estilo dominante, mas sim uma combinação de vários! Isso é excelente, pois significa que você tem flexibilidade para se adaptar a diferentes métodos de ensino. Você pode escolher a melhor estratégia (Visual, Auditiva, de Leitura ou Prática) dependendo do assunto. Use o gráfico para ver suas preferências!" }
              }
            };

            let perguntas = fullQuizDataPlaceholder.perguntas; // Substitua placeholder pelos dados reais
            let resultados = fullQuizDataPlaceholder.resultados; // Substitua placeholder pelos dados reais
            let myChart; 

            // --- 2. ELEMENTOS DO DOM ---
            const quizTitulo = document.getElementById('quiz-titulo');
            const quizDescricao = document.getElementById('quiz-descricao');
            const progressBar = document.getElementById('quiz-progress-bar');
            const perguntaTexto = document.getElementById('pergunta-texto');
            const quizOpcoes = document.getElementById('quiz-opcoes');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const finishBtn = document.getElementById('finish-btn');
            const quizArea = document.getElementById('quiz-area');
            const resultadoArea = document.getElementById('resultado-area');
            const restartBtn = document.getElementById('quiz-restart-btn');
            const backBtnGlobal = document.getElementById('back-to-main-global-btn'); 
            const errorArea = document.getElementById('quiz-error-area');

            // --- 3. ESTADO DO QUIZ ---
            let currentQuestion = 0;
            const userAnswers = {}; 

            // --- 4. FUNÇÕES ---
            function showQuestion(index) {
                if (index < 0 || index >= perguntas.length) { console.error("Índice de pergunta inválido:", index); quizArea.classList.add('hidden'); errorArea.classList.remove('hidden'); return; }
                const pergunta = perguntas[index];
                perguntaTexto.textContent = `${index + 1}. ${pergunta.pergunta}`;
                quizOpcoes.innerHTML = ''; 
                pergunta.opcoes.forEach(opcao => {
                    const label = document.createElement('label'); label.className = 'quiz-opcao';
                    if (userAnswers[index] === opcao.valor) label.classList.add('selected');
                    const input = document.createElement('input'); input.type = 'radio'; input.name = `pergunta-${index}`; input.value = opcao.valor;
                    label.appendChild(input); label.appendChild(document.createTextNode(opcao.texto));
                    label.addEventListener('click', () => {
                        document.querySelectorAll(`#quiz-opcoes .quiz-opcao`).forEach(l => l.classList.remove('selected'));
                        label.classList.add('selected'); userAnswers[index] = opcao.valor;
                        nextBtn.disabled = false; finishBtn.disabled = false; 
                    });
                    quizOpcoes.appendChild(label);
                });
                const progress = ((index + 1) / perguntas.length) * 100; progressBar.style.width = `${progress}%`;
                prevBtn.classList.toggle('hidden', index === 0); nextBtn.classList.toggle('hidden', index === perguntas.length - 1); finishBtn.classList.toggle('hidden', index !== perguntas.length - 1);
                nextBtn.disabled = userAnswers[index] === undefined; finishBtn.disabled = userAnswers[index] === undefined;
                backBtnGlobal.classList.remove('hidden'); 
            }

            function showResults() {
                const scores = { V: 0, A: 0, R: 0, K: 0 };
                Object.values(userAnswers).forEach(answer => { if (scores.hasOwnProperty(answer)) scores[answer]++; });
                let estiloPrincipal = 'Multimodal'; let maxScore = 0; let empate = false;
                Object.keys(scores).forEach(estilo => {
                    if (scores[estilo] > maxScore) { maxScore = scores[estilo]; estiloPrincipal = estilo; empate = false; } 
                    else if (scores[estilo] === maxScore && maxScore > 0) { empate = true; }
                });
                if (empate) estiloPrincipal = 'Multimodal';
                const resultadoFinal = resultados[estiloPrincipal];
                document.getElementById('resultado-titulo').textContent = resultadoFinal.titulo;
                document.getElementById('resultado-descricao').textContent = resultadoFinal.descricao;
                const ctx = document.getElementById('resultado-grafico').getContext('2d');
                if (myChart) myChart.destroy(); 
                myChart = new Chart(ctx, {
                    type: 'doughnut', 
                    data: {
                        labels: ['Visual (V)', 'Auditivo (A)', 'Leitura/Escrita (R)', 'Cinético (K)'], 
                        datasets: [{
                            label: 'Pontuação', data: [scores.V, scores.A, scores.R, scores.K],
                            backgroundColor: ['rgba(75, 139, 234, 0.8)', 'rgba(255, 159, 64, 0.8)', 'rgba(75, 192, 192, 0.8)', 'rgba(255, 99, 132, 0.8)'],
                            borderColor: ['#4B8BEA', '#FF9F40', '#4BC0C0', '#FF6384'], borderWidth: 1
                        }]
                    },
                    options: { 
                        responsive: true, plugins: { legend: { position: 'top' }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; if (label) label += ': '; if (context.parsed !== null) label += context.parsed + ' pontos'; return label; } } } } 
                    }
                });
                quizArea.classList.add('hidden'); resultadoArea.classList.remove('hidden');
                backBtnGlobal.classList.remove('hidden'); 
            }
            
            function restartQuiz() {
                currentQuestion = 0; Object.keys(userAnswers).forEach(key => delete userAnswers[key]);
                resultadoArea.classList.add('hidden'); quizArea.classList.remove('hidden');    
                showQuestion(0);                        
            }

            // --- 5. EVENT LISTENERS ---
            nextBtn.addEventListener('click', () => { if (currentQuestion < perguntas.length - 1) { currentQuestion++; showQuestion(currentQuestion); } });
            prevBtn.addEventListener('click', () => { if (currentQuestion > 0) { currentQuestion--; showQuestion(currentQuestion); } });
            finishBtn.addEventListener('click', showResults); 
            restartBtn.addEventListener('click', restartQuiz); 

            // --- 6. INICIALIZAÇÃO ---
            try {
                // AQUI USAMOS fullQuizDataPlaceholder - MUDE PARA fullQuizData QUANDO COLAR OS DADOS
                quizTitulo.textContent = fullQuizDataPlaceholder.titulo; 
                quizDescricao.textContent = fullQuizDataPlaceholder.descricao;
                showQuestion(0); 
            } catch (e) {
                console.error("Erro na inicialização:", e);
                quizArea.classList.add('hidden');
                errorArea.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>