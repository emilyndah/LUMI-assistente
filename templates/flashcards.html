<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards de Estudo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <header>
        <a href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='lumi_logo.jpg') }}" alt="Logo Lumi" class="logo">
        </a>
    </header>

    <main class="faq-page">

        <section class="faq-container">

            <div id="subject-selection">

                <a href="{{ url_for('index') }}" class="back-btn-flashcard-subject">← Voltar para o Chat</a>

                <h2>Flashcards</h2>
                <p>Selecione uma disciplina para revisar:</p>
                <div id="subject-buttons">
                    </div>
            </div>

            <div id="flashcard-viewer" class="hidden">
                <button id="back-to-subjects">← Voltar para Disciplinas</button>
                <h2 id="subject-title"></h2>

                <div id="flashcard-scene">
                    <div id="flashcard" class="flashcard">
                        <div class="card-face card-front">
                            <span id="flashcard-question"></span>
                        </div>
                        <div class="card-face card-back">
                            <span id="flashcard-answer"></span>
                        </div>
                    </div>
                </div>

                <div class="flashcard-nav">
                    <button id="prev-card">←</button>
                    <span id="card-counter">1/10</span>
                    <button id="next-card">→</button>
                </div>
            </div>

        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 1. Referências do DOM ---
            const subjectSelectionDiv = document.getElementById('subject-selection');
            const subjectButtonsContainer = document.getElementById('subject-buttons');
            const flashcardViewerDiv = document.getElementById('flashcard-viewer');
            const subjectTitle = document.getElementById('subject-title');
            const backToSubjectsBtn = document.getElementById('back-to-subjects'); // Botão dentro do viewer

            const flashcardElement = document.getElementById('flashcard');
            const questionEl = document.getElementById('flashcard-question');
            const answerEl = document.getElementById('flashcard-answer');
            const cardCounter = document.getElementById('card-counter');
            const prevCardBtn = document.getElementById('prev-card');
            const nextCardBtn = document.getElementById('next-card');

            // --- 2. Variáveis de Estado ---
            let allFlashcards = {{ flashcard_data|tojson }};
            let currentCards = [];
            let currentIndex = 0;

            // --- 3. Funções ---
            function showCard(index) {
                if (flashcardElement.classList.contains('is-flipped')) {
                    flashcardElement.classList.remove('is-flipped');
                }
                setTimeout(() => {
                    if (currentCards && currentCards[index]) {
                        questionEl.textContent = currentCards[index].pergunta;
                        answerEl.textContent = currentCards[index].resposta;
                        cardCounter.textContent = `${index + 1}/${currentCards.length}`;
                    } else {
                        console.error("Erro: Tentando acessar cartão inválido.");
                        questionEl.textContent = "Erro";
                        answerEl.textContent = "Erro";
                        cardCounter.textContent = `?/${currentCards ? currentCards.length : '?'}`;
                    }
                }, 150);
            }

            // --- 4. Inicialização ---
            const subjects = Object.keys(allFlashcards);
            subjects.forEach(subject => {
                const btn = document.createElement('button');
                btn.className = 'subject-btn';
                btn.textContent = subject;
                subjectButtonsContainer.appendChild(btn);

                btn.addEventListener('click', () => {
                    currentCards = allFlashcards[subject];
                    if (currentCards && currentCards.length > 0) {
                        currentIndex = 0;
                        subjectTitle.textContent = subject;
                        showCard(currentIndex);

                        // Esconde seleção e mostra o visualizador
                        subjectSelectionDiv.classList.add('hidden');
                        flashcardViewerDiv.classList.remove('hidden');
                    } else {
                        const p = document.createElement('p');
                        p.textContent = `Nenhum flashcard encontrado para "${subject}".`;
                        p.style.color = 'red';
                        p.style.textAlign = 'center';
                        subjectButtonsContainer.appendChild(p);
                        setTimeout(() => p.remove(), 3000);
                    }
                });
            });

            // --- 5. Event Listeners ---
            // Botão DENTRO do viewer para voltar à seleção de matérias
            backToSubjectsBtn.addEventListener('click', () => {
                subjectSelectionDiv.classList.remove('hidden');
                flashcardViewerDiv.classList.add('hidden');
            });

            // Virar o cartão
            flashcardElement.addEventListener('click', () => {
                flashcardElement.classList.toggle('is-flipped');
            });

            // Navegação
            prevCardBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    showCard(currentIndex);
                }
            });

            nextCardBtn.addEventListener('click', () => {
                if (currentIndex < currentCards.length - 1) {
                    currentIndex++;
                    showCard(currentIndex);
                }
            });
        });
    </script>
</body>
</html>